/*
 * insertRequestHeadersData.cpp
 *
 *  Created on: Jul 21, 2016
 *      Author: root
 */

#include "insertRequestHeadersData.h"

void CinsertRequestHeadersData::insert_default_data()
{
	m_dbcrawl.updateMysql(1, "default", "User-Agent", "Mozilla/5.0 (Windows NT 6.1; WOW64; rv:47.0) Gecko/20100101 Firefox/47.0");
	m_dbcrawl.updateMysql(1, "default", "Accept", "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8");
	m_dbcrawl.updateMysql(1, "default", "Accept-Language", "zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3");
	m_dbcrawl.updateMysql(1, "default", "Accept-Encoding", "gzip, deflate");
}

void CinsertRequestHeadersData::insert_tianya_data()
{
	m_dbcrawl.updateMysql(1, "www.tianya.com", "Accept", "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8");
	m_dbcrawl.updateMysql(1, "www.tianya.com", "User-Agent", "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36");
	m_dbcrawl.updateMysql(1, "www.tianya.com", "Accept-Encoding", "gzip, deflate, sdch");
}

void CinsertRequestHeadersData::insert_douban_data()
{
	m_dbcrawl.updateMysql(1, "www.douban.com", "Accept", "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8");
	m_dbcrawl.updateMysql(1, "www.douban.com", "User-Agent", "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36");
	m_dbcrawl.updateMysql(1, "www.douban.com", "Accept-Encoding", "gzip, deflate, sdch, br");
	m_dbcrawl.updateMysql(1, "www.douban.com", "Accept-Language", "zh-CN,zh;q=0.8");
}

void CinsertRequestHeadersData::insert_csdn_data()
{
	m_dbcrawl.updateMysql(1, "passport.csdn.net", "Accept", "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8");
	m_dbcrawl.updateMysql(1, "passport.csdn.net", "User-Agent", "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36");
	m_dbcrawl.updateMysql(1, "passport.csdn.net", "Accept-Encoding", "gzip, deflate, sdch, br");
	m_dbcrawl.updateMysql(1, "passport.csdn.net", "Accept-Language", "zh-CN,zh;q=0.8");
	m_dbcrawl.updateMysql(1, "passport.csdn.net", "Content-Type", "application/x-www-form-urlencoded");
	m_dbcrawl.updateMysql(1, "passport.csdn.net", "Origin", "http://passport.csdn.net");
	m_dbcrawl.updateMysql(1, "passport.csdn.net", "Referer", "http://passport.csdn.net/account/login;jsessionid=38E25E75506A35D92C34191538B0A40A.tomcat1?from= " \
			"http%3A%2F%2Fmy.csdn.net%2F%2Fmy%2Faccount%2Fchangepwd");
	m_dbcrawl.updateMysql(1, "passport.csdn.net", "Cookie", "JSESSIONID=38E25E75506A35D92C34191538B0A40A.tomcat1; JSESSIONID=38E25E75506A35D92C34191538B0A40A.tomcat1; "\
			"dc_tos=obqg70; uuid_tt_dd=5033012019688722354_20160811; dc_session_id=1470898044898");
}

void CinsertRequestHeadersData::insert_weibo_data()
{
	m_dbcrawl.updateMysql(1, "login.sina.com.cn", "Accept", "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8");
	m_dbcrawl.updateMysql(1, "login.sina.com.cn", "User-Agent", "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36");
	m_dbcrawl.updateMysql(1, "login.sina.com.cn", "Accept-Encoding", "gzip, deflate, sdch, br");
	m_dbcrawl.updateMysql(1, "login.sina.com.cn", "Accept-Language", "zh-CN,zh;q=0.8");
	m_dbcrawl.updateMysql(1, "login.sina.com.cn", "Content-Type", "application/x-www-form-urlencoded");
	m_dbcrawl.updateMysql(1, "login.sina.com.cn", "Origin", "http://weibo.com");
	m_dbcrawl.updateMysql(1, "login.sina.com.cn", "Referer", "http://weibo.com/");
	m_dbcrawl.updateMysql(1, "login.sina.com.cn", "Host", "login.sina.com.cn");
	m_dbcrawl.updateMysql(1, "login.sina.com.cn", "Upgrade-Insecure-Requests", "1");
}

void CinsertRequestHeadersData::insert_zhihu_data()
{
	m_dbcrawl.updateMysql(1, "www.zhihu.com", "Accept", "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8");
	m_dbcrawl.updateMysql(1, "www.zhihu.com", "User-Agent", "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36");
	m_dbcrawl.updateMysql(1, "www.zhihu.com", "Accept-Encoding", "gzip, deflate, sdch, br");
	m_dbcrawl.updateMysql(1, "www.zhihu.com", "Accept-Language", "zh-CN,zh;q=0.8");
}

void CinsertRequestHeadersData::insert_proxy_data()
{
	m_dbcrawl.updateMysql_proxy("127.0.0.1", 8080);
	m_dbcrawl.updateMysql_proxy("127.0.0.1", 8088);
	m_dbcrawl.updateMysql_proxy("127.0.0.1", 8888);
}

void CinsertRequestHeadersData::insert_requestHeaders_to_db_from_file(const string &file)
{
	CreadFile files;
	Csplit splits;
	string domain, key, value;

	vector<string> headers = files.getFileString(file);

	for(unsigned int header_index = 0; header_index < headers.size(); ++header_index)
	{
		int POST_pos = headers[header_index].find("POST", 0);
		int GET_pos = headers[header_index].find("GET", 0);

		int key_pos = headers[header_index].find(": ", 0);

		if(POST_pos == 0 || GET_pos == 0)
		{
			vector<string> requestmode = splits.split(headers[header_index], " "); //GET https://www.baidu.com/ HTTP/1.1
			if(requestmode.size() >= 3)
			{
				vector<string> domains = splits.split(requestmode[1], "/"); //https://www.baidu.com/
				if(domains.size() >= 3)
				{
					domain = domains[2];
				}
				//cout<<"domain: "<<domain<<endl;
			}
			continue;
		}
		else if(key_pos > 0)
		{
			vector<string> headerkey = splits.split(headers[header_index], ": "); //Connection: keep-alive
			if(headerkey.size() >= 2)
			{
				key = headerkey[0];
				value = headerkey[1];
			}
		}

		if(domain.size() > 0 && key.size() > 0 && value.size() > 0)
		{
			cout<<domain<<": "<<key<<" : "<<value<<endl;
			m_dbcrawl.updateMysql(1, domain, key, value);
			key.clear();
			value.clear();
		}
	}
}



